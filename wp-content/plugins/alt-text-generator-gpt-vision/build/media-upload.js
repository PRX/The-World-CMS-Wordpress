(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var n=e.n(t);const i=window.wp.element,s=window.wp.components,r=window.wp.htmlEntities,a=window.wp.i18n,o=window.wp.coreData,l=window.wp.apiFetch;var d=e.n(l);const c=async(e,t=!1,n,i)=>{const s={attachment_id:e,save:t};return n?.length&&(s.user_prompt=n),d()({path:"acpl/ai-alt-generator",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:i}).then(e=>e.alt).catch(e=>{throw console.error(e),e})};function h(e){return new Promise(t=>setTimeout(t,e))}const g=window.wp.primitives,u=window.ReactJSXRuntime,x=(0,u.jsx)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(g.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),p=(0,u.jsx)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(g.Path,{d:"M6.6 6L5.4 7l4.5 5-4.5 5 1.1 1 5.5-6-5.4-6zm6 0l-1.1 1 4.5 5-4.5 5 1.1 1 5.5-6-5.5-6z"})}),m=(0,u.jsx)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(g.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})});function v({details:e}){const{status:t,message:n}=e;return(0,u.jsx)(s.Flex,{justify:"start",children:"generating"===t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Spinner,{}),(0,a._x)("Generating...","Generation status","alt-text-generator-gpt-vision")]}):"generated"===t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Icon,{icon:x}),(0,a._x)("Generated","Generation status","alt-text-generator-gpt-vision")]}):"skipped"===t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Icon,{icon:p}),(0,a._x)("Skipped","Generation status","alt-text-generator-gpt-vision")]}):"error"===t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Icon,{icon:m}),(0,a.sprintf)((0,a._x)("Error: %s","Generation status","alt-text-generator-gpt-vision"),n)]}):null})}function w({loading:e,generationMap:t}){return(0,u.jsx)("div",{style:{maxHeight:"18rem",overflowY:"auto",marginBottom:"1rem",border:"1px solid #c3c4c7"},children:(0,u.jsxs)("table",{className:"wp-list-table fixed widefat striped",style:{border:"0"},children:[(0,u.jsx)("thead",{style:{position:"sticky",top:"0",backgroundColor:"white",zIndex:1},children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:(0,a.__)("File","alt-text-generator-gpt-vision")}),(0,u.jsx)("th",{children:(0,a.__)("Alt text","alt-text-generator-gpt-vision")}),(0,u.jsx)("th",{children:(0,a.__)("Status","alt-text-generator-gpt-vision")})]})}),(0,u.jsx)("tbody",{children:e?Array.from(t,([e,t])=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:(0,u.jsx)("a",{href:t.source_url,target:"_blank",style:{lineBreak:"anywhere"},children:(0,u.jsxs)(s.Flex,{align:"start",justify:"start",children:[t.thumbnail&&(0,u.jsx)("img",{src:t.thumbnail.source_url,height:t.thumbnail.height,width:t.thumbnail.width,alt:t.alt,loading:"lazy",decoding:"async",style:{maxWidth:"60px",height:"auto"}}),t.title]})})}),(0,u.jsx)("td",{children:t.alt}),(0,u.jsx)("td",{children:(0,u.jsx)(v,{details:t})})]},e)):(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:3,style:{textAlign:"center"},children:(0,u.jsx)(s.Spinner,{})})})})]})})}const j=(0,a.__)("Custom prompt (optional)","alt-text-generator-gpt-vision"),_=(0,a.__)("Provide custom instructions for AI to tailor the alt text generation, such as including specific keywords for SEO.","alt-text-generator-gpt-vision"),f=(0,a._x)('e.g. Include terms like "AI", "robotics"',"Additional prompt placeholder","alt-text-generator-gpt-vision");function b({rows:e=1,label:t=j,help:n=_,placeholder:i=f,...r}){return(0,u.jsx)(s.TextareaControl,{rows:e,label:t,help:n,placeholder:i,style:{fieldSizing:"content",maxBlockSize:"6rlh"},...r})}const y=(0,u.jsx)(g.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)(g.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0ZM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm-.75 12v-1.5h1.5V16h-1.5Zm0-8v5h1.5V8h-1.5Z"})}),C=({showIcon:e=!0})=>(0,u.jsxs)(s.Flex,{align:"center",justify:"end",gap:1,children:[e&&(0,u.jsx)(s.Icon,{icon:y,size:22}),(0,u.jsx)("small",{children:(0,a.__)("AI can make mistakes. Please double-check generated text.","alt-text-generator-gpt-vision")})]}),k=(0,a.__)("Save alt text in media library","alt-text-generator-gpt-vision");function S({label:e=k,checked:t,onChange:n,disabled:i=!1}){return(0,u.jsx)(s.ToggleControl,{label:e,checked:t,onChange:n,help:t?(0,a.__)("Alternative text will be saved in the WordPress media library, making it available for reuse across site.","alt-text-generator-gpt-vision"):(0,a.__)("Alternative text will only be saved for the current editor block.","alt-text-generator-gpt-vision"),disabled:i})}function A({attachmentIds:e,onGenerate:t,onClose:n,context:l="mediaLibrary"}){const[d,g]=(0,i.useState)(!1),[x,p]=(0,i.useState)(""),[m,v]=(0,i.useState)("mediaLibrary"===l),[j,_]=(0,i.useState)(!1),{attachments:f,hasResolved:y}=function(e){const{records:t,hasResolved:n,isResolving:i}=(0,o.useEntityRecords)("postType","attachment",{include:e,per_page:-1,context:"view"});return{attachments:null!=t?t:[],hasResolved:n}}(e),[k,A]=(0,i.useState)(new Map(e.map(e=>[e,{status:"",alt:""}]))),E=(0,i.useRef)(new AbortController);return(0,i.useEffect)(()=>{f.length&&A(e=>{const t=new Map(e);return f.forEach(e=>{var n,i;const s=t.get(e.id);if(!s)return void console.error("Generation details not found for attachment",e);s.alt=e.alt_text,s.title=(0,r.decodeEntities)(e.title.rendered),s.source_url=e.source_url;const a=null!==(n=null!==(i=e.media_details.sizes?.thumbnail)&&void 0!==i?i:e.media_details.sizes?.[0])&&void 0!==n?n:{width:e.media_details.width,height:e.media_details.height,source_url:e.source_url};a&&(s.thumbnail={width:a.width,height:a.height,source_url:a.source_url}),t.set(e.id,s)}),t})},[f,y]),(0,i.useEffect)(()=>()=>{E.current.abort()},[]),(0,u.jsxs)(s.Modal,{title:(0,a.__)("Generate Alternative Texts","alt-text-generator-gpt-vision"),onRequestClose:n,shouldCloseOnClickOutside:!1,shouldCloseOnEsc:!j,style:{maxWidth:"48rem"},children:[(0,u.jsx)(b,{value:x,onChange:p,disabled:j}),(0,u.jsx)(s.ToggleControl,{label:(0,a.__)("Overwrite existing alternative texts","alt-text-generator-gpt-vision"),help:d?(0,a.__)("The existing alternative texts will be overwritten with the new ones.","alt-text-generator-gpt-vision"):(0,a.__)("The existing alternative texts will be preserved.","alt-text-generator-gpt-vision"),checked:d,onChange:g,disabled:j}),"editor"===l&&(0,u.jsx)(S,{checked:m,onChange:v,disabled:j}),(0,u.jsx)(w,{loading:y,generationMap:k}),(0,u.jsx)(C,{}),(0,u.jsxs)(s.Flex,{children:[(0,u.jsx)("p",{children:(0,a.sprintf)((0,a._n)("%d image selected","%d images selected",e.length,"alt-text-generator-gpt-vision"),e.length)}),(0,u.jsx)(s.FlexItem,{children:(0,u.jsxs)(s.Flex,{justify:"end",children:[(0,u.jsx)(s.Button,{onClick:n,isDestructive:!0,children:(0,a.__)("Cancel","alt-text-generator-gpt-vision")}),(0,u.jsx)(s.Button,{variant:"primary",disabled:j||!y,isBusy:j,onClick:async()=>{E.current=new AbortController,_(!0);const e=[];for(const[n,i]of k){if(!d&&i.alt.length>0){A(e=>new Map(e.set(n,{...i,status:"skipped"})));continue}A(e=>new Map(e.set(n,{...i,status:"generating"})));const s=c(n,m,x,E.current.signal).then(e=>{const s=f.find(e=>e.id===n);s&&(s.alt_text=e),A(t=>new Map(t.set(n,{...i,alt:e,status:"generated"}))),t&&t({id:n,alt:e})}).catch(e=>{A(t=>new Map(t.set(n,{...i,status:"error",message:e.message}))),console.error(e)});e.push(s),await h(1e3)}await Promise.all(e),_(!1),document.dispatchEvent(new CustomEvent("altTextsGenerated"))},children:(0,a.__)("Start","alt-text-generator-gpt-vision")})]})})]})]})}const E=e=>{const t=window.wp;if(!t?.media?.view)return;const n=t.media.view.AttachmentsBrowser,i=t.media.view.Button,s=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.selectActivate,this),this.controller.on("select:deactivate",this.selectDeactivate,this)},toggleDisabled:function(){this.model.set("disabled",!this.controller.state().get("selection").length)},selectActivate:function(){this.toggleDisabled(),this.$el.removeClass("hidden")},selectDeactivate:function(){this.toggleDisabled(),this.$el.addClass("hidden")},render:function(){return i.prototype.render.apply(this,arguments),this.controller.isModeActive("select")?this.selectActivate():this.selectDeactivate(),this},click:function(){const t=this.controller.state().get("selection");t.length&&e(t.models.map(e=>e.id))}});t.media.view.AttachmentsBrowser=n.extend({createToolbar:function(){n.prototype.createToolbar.apply(this,arguments),this.toolbar.set("bulkAltGenerate",new s({style:"primary",disabled:!0,text:(0,a.__)("Generate alternative text","alt-text-generator-gpt-vision"),controller:this.controller,priority:-75}).render()),document.addEventListener("altTextsGenerated",e=>{this.controller.state().get("library")._requery(!0),this.controller.trigger("selection:action:done")})}})},M=()=>{const[e,t]=(0,i.useState)(!1),[n,s]=(0,i.useState)([]);return(0,i.useEffect)(()=>{const e=e=>{s(e.detail.ids),t(!0)};return document.addEventListener("triggerBulkAltGenerateModal",e),()=>{document.removeEventListener("triggerBulkAltGenerateModal",e)}},[]),(0,i.useEffect)(()=>{const e=function(e,t=document){return t.querySelector(e)}("form#posts-filter");if(!e)return;const n=n=>{const i=new FormData(e);if("generate_alt_text"!==i.get("action"))return;n.preventDefault();const r=i.getAll("media[]").map(e=>Number(e));s(r),t(!0)};return e.addEventListener("submit",n),()=>{e.removeEventListener("submit",n)}},[]),e?(0,u.jsx)(A,{attachmentIds:n,onClose:()=>t(!1)}):null};n()(()=>{E(e=>{document.dispatchEvent(new CustomEvent("triggerBulkAltGenerateModal",{detail:{ids:e}}))});const e=document.createElement("div");e.id="acpl-bulk-generate-alts-app",document.body.appendChild(e),(0,i.createRoot)(e).render((0,u.jsx)(M,{}))})})();
//# sourceMappingURL=media-upload.js.map